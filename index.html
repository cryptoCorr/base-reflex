<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reflex Test: Hızlı Tepki</title>
    
    <!-- Tailwind, React, ReactDOM ve Babel kütüphanelerini yükle -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; cursor: pointer; margin: 0; }
        #root {
            width: 100vw;
            height: 100vh;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Tüm React Kancalarını İçe Aktar
        const { useState, useEffect, useRef } = React;

        // Base Mini App SDK entegrasyonu
        const SDK = typeof window !== 'undefined' && window.SDK; 
        const AVERAGE_TIME_MS = 250; 
        
        const STATE = {
            INITIAL: 'INITIAL', 
            WAITING: 'WAITING', 
            READY: 'READY',     
            RESULT: 'RESULT',   
        };

        const App = () => {
            const [gameState, setGameState] = useState(STATE.INITIAL);
            const [startTime, setStartTime] = useState(null);
            const [reactionTime, setReactionTime] = useState(null); 
            const [message, setMessage] = useState("Ready to test your reflex?");
            const timeoutRef = useRef(null);

            // SDK Entegrasyonu (Farcaster/Base için kritik)
            useEffect(() => {
                if (SDK && SDK.Actions && SDK.Actions.ready) {
                    SDK.Actions.ready();
                }
            }, []);

            // [OYUN MANTIĞI]
            const handleScreenClick = () => {
                const now = performance.now();
                switch (gameState) {
                    case STATE.INITIAL:
                    case STATE.RESULT:
                        startWaitingPhase();
                        break;
                    case STATE.WAITING:
                        clearTimeout(timeoutRef.current);
                        setMessage("TOO EARLY! Clicked before the green light. Tap to restart.");
                        setGameState(STATE.INITIAL);
                        break;
                    case STATE.READY:
                        const timeTaken = Math.round(now - startTime);
                        setReactionTime(timeTaken);
                        
                        let resultMessage;
                        if (timeTaken < 150) {
                            resultMessage = "Lightning Fast! That's exceptional.";
                        } else if (timeTaken < AVERAGE_TIME_MS) {
                            resultMessage = "Above Average! Great job.";
                        } else if (timeTaken < 350) {
                            resultMessage = "Average Time. You're doing okay.";
                        } else {
                            resultMessage = "Below Average. Try to focus more!";
                        }
                        
                        setMessage(resultMessage);
                        setGameState(STATE.RESULT);
                        break;
                    default:
                        break;
                }
            };

            const startWaitingPhase = () => {
                setMessage("Wait for Green. Get Ready...");
                setGameState(STATE.WAITING);
                setReactionTime(null);
                const randomDelay = Math.floor(Math.random() * 3000) + 2000;
                timeoutRef.current = setTimeout(() => {
                    setStartTime(performance.now());
                    setMessage("GREEN! CLICK NOW!");
                    setGameState(STATE.READY);
                }, randomDelay);
            };

            useEffect(() => {
                return () => {
                    if (timeoutRef.current) {
                        clearTimeout(timeoutRef.current);
                    }
                };
            }, []);

            const getBgColorClass = () => {
                switch (gameState) {
                    case STATE.WAITING: return 'bg-red-600 text-white';
                    case STATE.READY: return 'bg-green-500 text-white';
                    case STATE.RESULT: return 'bg-indigo-600 text-white';
                    case STATE.INITIAL:
                    default: return 'bg-gray-800 text-gray-200'; // Başlangıç Rengi
                }
            };
            
            const getMessageText = () => {
                if (gameState === STATE.RESULT && reactionTime !== null) {
                    return reactionTime + " ms";
                }
                return message;
            };

            const getInstructionText = () => {
                if (gameState === STATE.WAITING) return "Do not click. Wait for the color change!";
                if (gameState === STATE.INITIAL || gameState === STATE.RESULT) return "Tap anywhere to start.";
                return "We are recording your reaction time!";
            };

            return (
                <div 
                    id="test-area"
                    className={`h-screen flex items-center justify-center p-4 transition-colors duration-300 ${getBgColorClass()}`}
                    onClick={handleScreenClick}
                >
                    <div className="text-center w-full max-w-md p-6 rounded-xl shadow-2xl backdrop-blur-sm bg-black/30">
                        <h1 className="text-5xl md:text-6xl font-extrabold mb-4 transition-all duration-200">
                            {getMessageText()}
                        </h1>
                        
                        {reactionTime !== null && gameState === STATE.RESULT && (
                            <div className="mt-6 p-4 bg-white/20 rounded-lg">
                                <p className="text-xl font-bold">
                                {message}
                                </p>
                                <p className="text-sm mt-2 opacity-80">
                                Average Human Reaction Time is ~{AVERAGE_TIME_MS} ms.
                                </p>
                            </div>
                        )}
                        
                        <p className="mt-8 text-lg font-light opacity-80">
                            {getInstructionText()}
                        </p>
                    </div>
                </div>
            );
        };
        
        // Uygulamayı DOM'a yerleştir
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
